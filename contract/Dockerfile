FROM node:18-alpine

ARG POLYGON_ALCHEMY_API_URL
ENV POLYGON_ALCHEMY_API_URL=$POLYGON_ALCHEMY_API_URL
ARG POLYGON_ALCHEMY_API_KEY
ENV POLYGON_ALCHEMY_API_KEY=$POLYGON_ALCHEMY_API_KEY
ARG METAMASK_PRIVATE_KEY
ENV METAMASK_PRIVATE_KEY=$METAMASK_PRIVATE_KEY
ARG CONTRACT_ADDRESS
ENV CONTRACT_ADDRESS=$CONTRACT_ADDRESS

WORKDIR /app

RUN npm config set fetch-retry-mintimeout 20000
RUN npm config set fetch-retry-maxtimeout 120000

COPY  package*.json ./
RUN npm ci
COPY . ./

RUN npx hardhat compile
RUN npm run build
